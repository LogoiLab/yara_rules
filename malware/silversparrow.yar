import "hash"

rule silversparrow_hashes {

     meta:
        author = "Chad Baxter"
        author_email = "cbax@doslabelectronics.com"
        date = "2021-02-22"
        updated = "2021-02-22"
        description = "Known hashes of the Silver Sparrow MacOS malware"

     contition:
       hash.md5(0, filesize) == "30c9bc7d40454e501c358f77449071aa" or
       hash.md5(0, filesize) == "fdd6fb2b1dfe07b0e57d4cbfef9c8149" or
       hash.md5(0, filesize) == "c668003c9c5b1689ba47a431512b03cc" or
       hash.md5(0, filesize) == "b370191228fef82635e39a137be470af"

}

rule silversparrow_javascript {
      meta:
        author = "Chad Baxter"
        author_email = "cbax@doslabelectronics.com"
        date = "2021-02-22"
        updated = "2021-02-22"
        description = "JavaScript function definitions for Silver Sparrow MacOS malware"

      strings:
        $0 = "function bash(command)"
        $1 = "function appendLine(line, file)"
        $2 = "function appendLinex(line, file)"
        $3 = "function appendLiney(line, file)"

      condition:
        all of them
}

rule silversparrow_launchagent {
      meta:
        author = "Chad Baxter"
        author_email = "cbax@doslabelectronics.com"
        date = "2021-02-22"
        updated = "2021-02-22"
        description = "Unique strings of Silver Sparrow MacOS malware LaunchAgent plist"

      strings:
        $plist_magic = "-//Apple//DTD PLIST 1.0//EN"
        $0 = "init_verx"
        $1 = "~/Library/Application\\ Support/verx_updater/verx.sh"

      condition:
        all of them
}